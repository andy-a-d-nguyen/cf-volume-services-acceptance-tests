#!/bin/bash

if [[ ! -r "${CONFIG}" ]]; then
  echo "FAIL: \$CONFIG must be set to the path of a PATs config JSON file"
  exit 1
fi

if [[ -z "$(command -v cf)" ]]; then
  echo "FAIL: Missing cf cli"
  exit 1
fi

if [[ -z "$(command -v ginkgo)" ]]; then
  echo "FAIL: Missing ginkgo cli"
  exit 1
fi

echo "Printing sanitized \$CONFIG:"
grep -v -e password "${CONFIG}"

cat <<EOT

Test flags:
TEST_DOCKER_PORA: ${TEST_DOCKER_PORA:-false}
TEST_LAZY_UNMOUNT: ${TEST_LAZY_UNMOUNT:-false}
TEST_MOUNT_FAIL_LOGGING: ${TEST_MOUNT_FAIL_LOGGING:-false}
TEST_MOUNT_OPTIONS: ${TEST_MOUNT_OPTIONS:-false}
TEST_MULTI_CELL: ${TEST_MULTI_CELL:-false}
TEST_READ_ONLY: ${TEST_READ_ONLY:-false}
TEST_WINDOWS_CELL: ${TEST_WINDOWS_CELL:-false}

EOT

export ASSETS_PATH=assets
export TEST_APPLICATION_PATH=assets/pora

echo "Using $(ginkgo version)"
ginkgo "$@"
