#!/bin/bash

if [[ ! -r "${CONFIG}" ]]; then
  echo "FAIL: \$CONFIG must be set to the path of a PATs config JSON file"
  exit 1
fi

if [[ -z "$(command -v ginkgo)" ]]; then
  echo "FAIL: Missing ginkgo cli"
  exit 1
fi

echo "Printing sanitized \$CONFIG:"
grep -v -e password "${CONFIG}"

export ASSETS_PATH=assets

if [[ ${TEST_WINDOWS_CELL} == "true" ]]; then
  export TEST_APPLICATION_PATH="${ASSETS_PATH}/pora-windows"
else
  export TEST_APPLICATION_PATH="${ASSETS_PATH}/pora"
fi

echo "Using $(ginkgo version)"
ginkgo "$@"
